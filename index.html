<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PAV+ 3.7 ULTRA</title>

<link rel="manifest" href="manifest.json">
<link rel="icon" href="IMG_5759.png">
<link rel="apple-touch-icon" href="IMG_5759.png">
<meta name="theme-color" content="#d4af37">

<style>
:root{
--gold:#d4af37;
--bg:#0b0b0d;
--card:rgba(255,255,255,0.05);
--border:rgba(212,175,55,0.3);
--red:#ff3b3b;
--green:#29ff8a;
}

*{margin:0;padding:0;box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,sans-serif;}
body{background:var(--bg);color:white;overflow:hidden;}

/* SPLASH */
#splash{position:fixed;inset:0;background:black;display:flex;align-items:center;justify-content:center;z-index:4000;transition:opacity 1s;}
#splash.fade{opacity:0;pointer-events:none;}
.paw{font-size:42px;color:var(--gold);animation:glow 2s infinite;}
@keyframes glow{
0%{text-shadow:0 0 5px var(--gold);}
50%{text-shadow:0 0 25px var(--gold);}
100%{text-shadow:0 0 5px var(--gold);}
}

/* LOCK */
#lock{position:fixed;inset:0;background:black;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:3000;}
.display{font-size:32px;letter-spacing:15px;margin-bottom:20px;color:var(--gold);}
.keypad{display:grid;grid-template-columns:repeat(3,80px);gap:15px;}
.key{
height:80px;width:80px;border-radius:50%;
background:#111;border:1px solid var(--gold);
display:flex;align-items:center;justify-content:center;
font-size:24px;cursor:pointer;
}
.key:active{background:var(--gold);color:black;}

/* APP */
#app{display:none;height:100vh;overflow:hidden;}

.section{
position:absolute;top:0;left:0;right:0;bottom:70px;
display:flex;justify-content:center;
padding:20px;overflow:auto;
opacity:0;transform:translateX(20px);
transition:.35s ease;
pointer-events:none;
}
.section.active{
opacity:1;transform:translateX(0);
pointer-events:auto;
}

.container{width:100%;max-width:520px;}

.card{
background:var(--card);
backdrop-filter:blur(12px);
padding:20px;border-radius:15px;
border:1px solid var(--border);
margin-bottom:20px;text-align:center;
}

h3{margin-bottom:15px;color:var(--gold);}
input{
width:100%;padding:10px;margin-top:10px;
border-radius:8px;border:none;
background:#111;color:white;text-align:center;
}
button{
margin-top:10px;padding:8px 14px;
border:none;border-radius:8px;
background:var(--gold);color:black;
font-weight:bold;cursor:pointer;
}

/* TABBAR */
.tabbar{
position:fixed;bottom:0;left:0;right:0;
height:70px;background:#111;
display:flex;justify-content:space-around;
align-items:center;border-top:1px solid rgba(255,255,255,.1);
}
.tab{flex:1;text-align:center;color:#888;font-size:12px;cursor:pointer;transition:.3s;}
.tab.active{color:var(--gold);transform:translateY(-5px);}
.tab span{display:block;font-size:20px;}
.tab.active span{text-shadow:0 0 10px var(--gold);}

/* ALARM */
.alarm.armed{animation:redPulse 1.5s infinite;border-color:var(--red);}
@keyframes redPulse{
0%{box-shadow:0 0 5px var(--red);}
50%{box-shadow:0 0 25px var(--red);}
100%{box-shadow:0 0 5px var(--red);}
}

.log{
font-size:12px;
max-height:200px;
overflow:auto;
background:#111;
padding:10px;
border-radius:8px;
text-align:left;
}
</style>
</head>
<body>

<div id="splash"><div class="paw">ðŸ¦š PAV+</div></div>

<div id="lock">
<div class="display" id="display">----</div>
<div class="keypad" id="keys"></div>
</div>

<div id="app">

<div class="section active" id="alarmSection">
<div class="container">
<div class="card alarm" id="alarmCard">
<h3>Alarm</h3>

<button onclick="startArm()">UzbrÃ³j (5s)</button>
<button onclick="disarm()">RozbrÃ³j</button>

<input type="time" id="scheduleTime">
<button onclick="saveSchedule()">Zapisz godzinÄ™</button>
<button id="toggleScheduleBtn" onclick="toggleSchedule()">Harmonogram OFF</button>

<div id="mainCameraBox" style="margin-top:15px;"></div>

</div>
</div>
</div>

<div class="section" id="logSection">
<div class="container">
<div class="card">
<h3>Log</h3>
<button onclick="exportLog()">Eksport TXT</button>
<button onclick="clearLog()">WyczyÅ›Ä‡</button>
<div class="log" id="logBox"></div>
</div>
</div>
</div>

<div class="tabbar">
<div class="tab active" onclick="switchTab('alarmSection',this)">
<span>ðŸš¨</span>Alarm
</div>
<div class="tab" onclick="switchTab('logSection',this)">
<span>ðŸ“œ</span>Log
</div>
</div>

</div>

<script>

/* SPLASH */
setTimeout(()=>splash.classList.add("fade"),1500);

/* PIN SECURITY */
let failedAttempts=0;
let lockUntil=0;
const AUTO_LOCK_TIME=5*60*1000;

function hashPin(pin){
return btoa(pin);
}

if(!localStorage.getItem("pinHash")){
localStorage.setItem("pinHash",hashPin("1111"));
}

let input="";
let lastActivity=Date.now();

function update(){display.innerText=input.padEnd(4,"-");}

function press(v){
if(Date.now()<lockUntil)return;

if(v==="C"){input="";}
else if(v==="OK"){
if(hashPin(input)===localStorage.getItem("pinHash")){
unlock();
}else{
failedAttempts++;
log("BÅ‚Ä™dny PIN");
if(failedAttempts>=3){
lockUntil=Date.now()+60000;
alert("Blokada 60 sekund");
}
}
input="";
}else if(input.length<4){input+=v;}
update();
}

function unlock(){
lock.style.display="none";
app.style.display="block";
failedAttempts=0;
lastActivity=Date.now();
}

for(let i=1;i<=9;i++)create(i);
create("C");create(0);create("OK");

function create(v){
let d=document.createElement("div");
d.className="key";
d.innerText=v;
d.onclick=()=>press(v);
keys.appendChild(d);
}
update();

/* AUTO LOCK */
setInterval(()=>{
if(app.style.display==="block" && Date.now()-lastActivity>AUTO_LOCK_TIME){
location.reload();
}
},10000);

document.addEventListener("click",()=>lastActivity=Date.now());

/* TABS */
function switchTab(id,el){
document.querySelectorAll(".section").forEach(s=>s.classList.remove("active"));
document.getElementById(id).classList.add("active");
document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
el.classList.add("active");
}

/* LOG */
function log(txt){
let logs=JSON.parse(localStorage.getItem("logs"))||[];
logs.unshift(new Date().toLocaleTimeString()+" - "+txt);
if(logs.length>100) logs.pop();
localStorage.setItem("logs",JSON.stringify(logs));
renderLog();
}
function renderLog(){
let logs=JSON.parse(localStorage.getItem("logs"))||[];
logBox.innerHTML=logs.join("<br>");
}
renderLog();

function clearLog(){
localStorage.removeItem("logs");
renderLog();
}

function exportLog(){
let logs=localStorage.getItem("logs")||"";
let blob=new Blob([logs],{type:"text/plain"});
let a=document.createElement("a");
a.href=URL.createObjectURL(blob);
a.download="pav_log.txt";
a.click();
}

/* ALARM */
let armed=false;

function startArm(){
let countdown=5;
let interval=setInterval(()=>{
countdown--;
if(countdown<=0){
clearInterval(interval);
arm();
}
},1000);
}

function arm(auto=false){
armed=true;
alarmCard.classList.add("armed");
log(auto?"Auto uzbrojenie":"Alarm uzbrojony");
}

function disarm(){
armed=false;
alarmCard.classList.remove("armed");
log("Alarm rozbrojony");
}

/* HARMONOGRAM */
let scheduleEnabled=false;

function saveSchedule(){
localStorage.setItem("scheduleTime",scheduleTime.value);
log("Ustawiono harmonogram");
}

function toggleSchedule(){
scheduleEnabled=!scheduleEnabled;
toggleScheduleBtn.innerText="Harmonogram "+(scheduleEnabled?"ON":"OFF");
}

setInterval(()=>{
if(!scheduleEnabled)return;
let t=localStorage.getItem("scheduleTime");
if(!t)return;
let now=new Date();
let current=now.getHours().toString().padStart(2,"0")+":"+now.getMinutes().toString().padStart(2,"0");
if(current===t && !armed) arm(true);
},60000);

/* PWA */
if("serviceWorker" in navigator){
window.addEventListener("load",()=>navigator.serviceWorker.register("sw.js"));
}

// === ULTRA MODULES ===
/* =========================
   KAMERY 6x + OFFLINE + FULLSCREEN + SWIPE
========================= */

let cams = JSON.parse(localStorage.getItem("cams")) || [];
let mainCameraIndex = localStorage.getItem("mainCameraIndex") || 0;

const camSection = document.createElement("div");
camSection.className = "section";
camSection.id = "camSection";

camSection.innerHTML = `
<div class="container">
<div class="card">
<h3>Kamery (6)</h3>

<input id="camInput" placeholder="Adres embed kamery">
<button onclick="addCam()">Dodaj kamerÄ™</button>
<button onclick="openWall()">Monitoring Wall</button>

<div class="grid" id="camGrid" style="margin-top:15px;"></div>
</div>
</div>
`;

document.getElementById("app").appendChild(camSection);

const tabBar = document.querySelector(".tabbar");

const camTab = document.createElement("div");
camTab.className = "tab";
camTab.innerHTML = "<span>ðŸŽ¥</span>Kamery";
camTab.onclick = function(){ switchTab('camSection', this); };
tabBar.appendChild(camTab);

function renderCams(){
const grid = document.getElementById("camGrid");
grid.innerHTML = "";

for(let i=0;i<6;i++){
let url = cams[i] || "";

let div = document.createElement("div");
div.className = "camera";

if(url){
div.innerHTML = `
<span class="statusDot online" id="status-${i}"></span>
<button class="remove" onclick="event.stopPropagation();removeCam(${i})">Ã—</button>
<iframe src="${url}" onload="setOnline(${i},true)" onerror="setOnline(${i},false)"></iframe>
`;

div.addEventListener("click",()=>openFullscreen(i));

}else{
div.innerHTML = `<div style="height:150px;display:flex;align-items:center;justify-content:center;opacity:.4;">Brak</div>`;
}

grid.appendChild(div);
}

renderMainCamera();
}

function setOnline(i,state){
let dot = document.getElementById("status-"+i);
if(!dot) return;
dot.classList.remove("online","offline");
dot.classList.add(state?"online":"offline");
if(!state){
log("Kamera "+(i+1)+" offline");
}
}

function addCam(){
if(cams.length>=6){alert("Max 6 kamer");return;}
let url = document.getElementById("camInput").value;
if(!url) return;
cams.push(url);
localStorage.setItem("cams",JSON.stringify(cams));
document.getElementById("camInput").value="";
renderCams();
log("Dodano kamerÄ™");
}

function removeCam(i){
cams.splice(i,1);
localStorage.setItem("cams",JSON.stringify(cams));
renderCams();
log("UsuniÄ™to kamerÄ™");
}

/* FULLSCREEN + SWIPE */
function openFullscreen(i){
let wrapper = document.createElement("div");
wrapper.className = "camera fullscreen";
wrapper.innerHTML = `<iframe src="${cams[i]}"></iframe>`;
document.body.appendChild(wrapper);

let startY=0;
wrapper.addEventListener("touchstart",e=>startY=e.touches[0].clientY);
wrapper.addEventListener("touchmove",e=>{
if(e.touches[0].clientY-startY>100){
wrapper.remove();
}
});
wrapper.addEventListener("click",()=>wrapper.remove());
}

/* MONITORING WALL */
function openWall(){
let wall = document.createElement("div");
wall.style.position="fixed";
wall.style.inset="0";
wall.style.background="black";
wall.style.zIndex="5000";
wall.style.display="grid";
wall.style.gridTemplateColumns="repeat(3,1fr)";
wall.style.gridTemplateRows="repeat(2,1fr)";
wall.style.gap="5px";

cams.forEach(url=>{
let iframe=document.createElement("iframe");
iframe.src=url;
iframe.style.width="100%";
iframe.style.height="100%";
iframe.style.border="none";
wall.appendChild(iframe);
});

wall.addEventListener("click",()=>wall.remove());
document.body.appendChild(wall);
}

/* MAIN CAMERA IN ALARM */
function renderMainCamera(){
const box=document.getElementById("mainCameraBox");
if(!box) return;

if(cams.length>0){
box.innerHTML=`<iframe src="${cams[mainCameraIndex]}" style="width:100%;height:180px;border:none;border-radius:12px;"></iframe>`;
}else{
box.innerHTML="<div style='opacity:.4;'>Brak gÅ‚Ã³wnej kamery</div>";
}
}

/* =========================
   OÅšWIETLENIE ULTRA + PRESETY
========================= */

let lights = JSON.parse(localStorage.getItem("lights")) || [];

const lightSection = document.createElement("div");
lightSection.className="section";
lightSection.id="lightSection";

lightSection.innerHTML=`
<div class="container">
<div class="card">
<h3>OÅ›wietlenie</h3>

<input id="lightInput" placeholder="Adres urzÄ…dzenia">
<button onclick="addLight()">Dodaj</button>

<button onclick="presetNight()">Preset Noc</button>
<button onclick="presetHome()">Preset Dom</button>
<button onclick="presetAway()">Preset Wyjazd</button>

<div id="lightList" style="margin-top:15px;"></div>
</div>
</div>
`;

document.getElementById("app").appendChild(lightSection);

const lightTab=document.createElement("div");
lightTab.className="tab";
lightTab.innerHTML="<span>ðŸ’¡</span>ÅšwiatÅ‚o";
lightTab.onclick=function(){switchTab('lightSection',this)};
tabBar.appendChild(lightTab);

function renderLights(){
const list=document.getElementById("lightList");
list.innerHTML="";
lights.forEach((l,i)=>{
let div=document.createElement("div");
div.style.marginBottom="5px";
div.innerHTML=`${l} <button onclick="removeLight(${i})">Ã—</button>`;
list.appendChild(div);
});
}

function addLight(){
let val=document.getElementById("lightInput").value;
if(!val) return;
lights.push(val);
localStorage.setItem("lights",JSON.stringify(lights));
document.getElementById("lightInput").value="";
renderLights();
log("Dodano oÅ›wietlenie");
}

function removeLight(i){
lights.splice(i,1);
localStorage.setItem("lights",JSON.stringify(lights));
renderLights();
}

function presetNight(){
log("Preset Noc aktywowany");
}

function presetHome(){
log("Preset Dom aktywowany");
}

function presetAway(){
log("Preset Wyjazd aktywowany");
}

/* INTEGRACJA Z ALARMEM */
function arm(auto=false){
armed=true;
alarmCard.classList.add("armed");
log(auto?"Auto uzbrojenie":"Alarm uzbrojony");
presetAway();
}

renderCams();
renderLights();
</script>
</body>
</html>
